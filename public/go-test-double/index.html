<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Go Test Doubles by Example | Amin Rashidbeigi</title>
<meta name="keywords" content="test double, go, fake, spy, mock, stub, dummy, testing">
<meta name="description" content="Test doubles serve as an alternative to real dependencies in testing. In this post, we&#39;ll review all test doubles using a real-world Go example.">
<meta name="author" content="Amin Rashidbeigi">
<link rel="canonical" href="https://aminrb.me/go-test-double/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.2d50b1531bd1b3146d65c5543bd298f7f982786aadee4c223cb3a1cb51906106.css" integrity="sha256-LVCxUxvRsxRtZcVUO9KY9/mCeGqt7kwiPLOhy1GQYQY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://aminrb.me/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://aminrb.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://aminrb.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://aminrb.me/apple-touch-icon.png">
<link rel="mask-icon" href="https://aminrb.me/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://aminrb.me/go-test-double/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S18R7YECZP"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-S18R7YECZP', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Go Test Doubles by Example" />
<meta property="og:description" content="Test doubles serve as an alternative to real dependencies in testing. In this post, we&#39;ll review all test doubles using a real-world Go example." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aminrb.me/go-test-double/" />
<meta property="og:image" content="https://aminrb.me/go-test-double/go-test-double.jpg" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-12-31T14:37:31+03:30" />
<meta property="article:modified_time" content="2023-12-31T14:37:31+03:30" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://aminrb.me/go-test-double/go-test-double.jpg" />
<meta name="twitter:title" content="Go Test Doubles by Example"/>
<meta name="twitter:description" content="Test doubles serve as an alternative to real dependencies in testing. In this post, we&#39;ll review all test doubles using a real-world Go example."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://aminrb.me/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Go Test Doubles by Example",
      "item": "https://aminrb.me/go-test-double/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Go Test Doubles by Example",
  "name": "Go Test Doubles by Example",
  "description": "Test doubles serve as an alternative to real dependencies in testing. In this post, we'll review all test doubles using a real-world Go example.",
  "keywords": [
    "test double", "go", "fake", "spy", "mock", "stub", "dummy", "testing"
  ],
  "articleBody": "Introduction When writing tests for a program, we often need to consider dependencies and external APIs that we prefer not to call every time the test runs. Calling these external dependencies not only adds complexity to our tests but also incurs costs. To address this issue, we can use test doubles.\nWhat Are Test Doubles? Test doubles offer an alternative to real dependencies. While we commonly refer to all of them as mocks, there are various test doubles, each serving different purposes.\nLet’s briefly review each type of test double:\nFake: Fakes are actual implementations of dependencies, in a simpler and chipper way. Consider a scenario where we have a database dependency. We can create a fake in-memory database that implements the database interface, allowing us to use it as a substitute for the actual database. Dummy: Dummies act as placeholder objects. We don’t utilize their functionalities; instead, we pass parameters just to fulfill test requirements. We don’t want to test their logic or behavior. Mock: Sometimes we want to test the behavior of our logic rather than the implementation or output. Mocks are for this purpose. For instance, ensuring a specific API called only once per request can be achieved by mocking that API. Stub: When testing particular logic, we might need to assess the program’s state rather than its behavior. Stubs come into play by generating predefined responses for specific parameters. Spy: Spies, similar to stubs, offer dynamic behavior based on how they’re invoked, providing a more interactive aspect. We can say that spies inherit from both stubs and mocks. If you’re unfamiliar with test doubles and want to read more about them, check the resources I’ve referenced at the end of the post.\nTest Doubles by an Example Now that we’ve reviewed all test doubles, let’s explain each of them using a real-world Go example.\nImagine we have a Payment service that depends on a payment gateway and contains a ProcessPayment method implementing logic when a user submits a payment. We want to write some test double for the payment package.\nPayment Gateway Dependency First of all, let’s define a simple implementation of an example gateway:\n1 2 3 4 5 6 7 8 9 10 11 12 package gateway import \"errors\" type RealPaymentGateway struct{} func (r *RealPaymentGateway) ProcessPayment(amount float64) error { if amount \u003c= 0 { return errors.New(\"invalid payment amount\") } return nil } Payment Processor Now, let’s create a simple implementation of the PaymentProcessor. A gateway is as an input for this processor, and it includes a Process function that calls the ProcessPayment method of the gateway.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package payment type PaymentGateway interface { ProcessPayment(amount float64) error } type PaymentProcessor struct { gateway PaymentGateway } func NewPaymentProcessor(gateway PaymentGateway) *PaymentProcessor { return \u0026PaymentProcessor{ gateway: gateway, } } func (p *PaymentProcessor) Process(amount float64) error { return p.gateway.ProcessPayment(amount) } Now, let’s initialize our program with the main function:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package main import ( \"fmt\" \"github.com/aminrashidbeigi/go-test-doubles/gateway\" \"github.com/aminrashidbeigi/go-test-doubles/payment\" ) func main() { realPaymentGateway := \u0026gateway.RealPaymentGateway{} paymentProcessor := payment.NewPaymentProcessor(realPaymentGateway) amount := 100.0 err := paymentProcessor.Process(amount) if err != nil { fmt.Println(\"Payment failed:\", err) return } fmt.Println(\"Payment processed successfully!\") } When we run this program we get this output:\nPayment processed successfully! So, our program works well. Now, we’ve reached the fun part – writing tests!\nTest Doubles Implementations Dummy As I said, dummy just pass parameters to initialize a dependency and we don’t expect anything from them. In this example, the PaymentGatewayDummy satisfies the PaymentGateway interface by implementing the ProcessPayment method but does nothing inside the method. It’s simply there to fulfill the requirement of a PaymentGateway object for the tests that rely on this interface.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 type PaymentGatewayDummy struct{} func (d *PaymentGatewayDummy) ProcessPayment(amount float64) error { return nil } func TestPaymentProcessor_WithDummy(t *testing.T) { paymentProcessor := payment.NewPaymentProcessor(\u0026PaymentGatewayDummy{}) err := paymentProcessor.Process(100.0) if err != nil { t.Errorf(\"Expected no error, got %v\", err) } } Fake In the payment system example, the PaymentGatewayFake provides an alternative implementation with simpler logic. Here’s the fake implementation:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 type PaymentGatewayFake struct{} func (f *PaymentGatewayFake) ProcessPayment(amount float64) error { if amount \u003c= 0 { return errors.New(\"invalid amount\") } return nil } func TestPaymentProcessor_WithFake(t *testing.T) { paymentProcessor := payment.NewPaymentProcessor(\u0026PaymentGatewayFake{}) err := paymentProcessor.Process(0) if err == nil { t.Error(\"Expected an error for zero amount, got none\") } errNegative := paymentProcessor.Process(-10) if errNegative == nil { t.Error(\"Expected an error for negative amount, got none\") } } Mock Mocks are used to define and enforce expectations on interactions with an object. They specify certain method calls with specific parameters and help verify that these interactions occur as expected during tests. In this example, the mock records each call made to ProcessPayment, allowing later verification to ensure that the expected method calls happened in the specified order and with the correct parameters.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 type PaymentGatewayMock struct { calls []string callAmount float64 } func (m *PaymentGatewayMock) ProcessPayment(amount float64) error { m.calls = append(m.calls, \"ProcessPayment\") m.callAmount = amount return nil } func (m *PaymentGatewayMock) VerifyCalls(expectedCalls []string) bool { if len(expectedCalls) != len(m.calls) { return false } for i, call := range expectedCalls { if call != m.calls[i] { return false } } return true } func TestPaymentProcessor_WithMock(t *testing.T) { paymentGatewayMock := \u0026PaymentGatewayMock{} paymentProcessor := payment.NewPaymentProcessor(paymentGatewayMock) amount := 75.0 _ = paymentProcessor.Process(amount) expectedCalls := []string{\"ProcessPayment\"} if !paymentGatewayMock.VerifyCalls(expectedCalls) { t.Errorf(\"Expected calls %v, got %v\", expectedCalls, paymentGatewayMock.calls) } if paymentGatewayMock.callAmount != amount { t.Errorf(\"Expected call amount %f, got %f\", amount, paymentGatewayMock.callAmount) } } Stub The stub here represents a simplified version of the PaymentGateway. It has a success boolean field that determines whether the payment should be successful or fail. The ProcessPayment method of the stub checks the success field and returns an error if success is set to false, simulating a failed payment.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 type PaymentGatewayStub struct { success bool } func (s *PaymentGatewayStub) ProcessPayment(amount float64) error { if !s.success { return errors.New(\"payment failed\") } return nil } func TestPaymentProcessor_WithStub_SuccessfulPayment(t *testing.T) { paymentProcessor := payment.NewPaymentProcessor(\u0026PaymentGatewayStub{success: true}) err := paymentProcessor.Process(100.0) if err != nil { t.Errorf(\"Expected no error, got %v\", err) } } func TestPaymentProcessor_WithStub_FailedPayment(t *testing.T) { paymentProcessor := payment.NewPaymentProcessor(\u0026PaymentGatewayStub{success: false}) err := paymentProcessor.Process(50.0) if err == nil { t.Error(\"Expected an error, got none\") } } Spy The spy here is used to track and record information about interactions with the PaymentGateway. It has called and amount fields to record whether the ProcessPayment method has been called and the amount passed to it. During testing, the spy captures and records this information, allowing tests to assert whether certain interactions have occurred.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 type PaymentGatewaySpy struct { called bool amount float64 } func (s *PaymentGatewaySpy) ProcessPayment(amount float64) error { s.called = true s.amount = amount return nil } func TestPaymentProcessor_WithSpy(t *testing.T) { paymentGatewaySpy := \u0026PaymentGatewaySpy{} paymentProcessor := payment.NewPaymentProcessor(paymentGatewaySpy) amount := 75.0 _ = paymentProcessor.Process(amount) if !paymentGatewaySpy.called { t.Error(\"Expected PaymentGatewaySpy to be called\") } if paymentGatewaySpy.amount != amount { t.Errorf(\"Expected amount %f, got %f\", amount, paymentGatewaySpy.amount) } } Wrapping up Each type of test double—dummies, stubs, spies, mocks, and fakes—has its unique role in testing of our code. They help us check if our code works correctly, create specific situations for testing, and make sure our tests happen in a safe space with reduced complexity and cost.\nI’ve placed all this code in a GitHub repository. You can check it here: Go Test Double.\nFurther Reading TestDouble - Martin Fowler Mocks Aren’t Stubs - Martin Fowler Test Double - XUnitPatterns ",
  "wordCount" : "1389",
  "inLanguage": "en",
  "image":"https://aminrb.me/go-test-double/go-test-double.jpg","datePublished": "2023-12-31T14:37:31+03:30",
  "dateModified": "2023-12-31T14:37:31+03:30",
  "author":{
    "@type": "Person",
    "name": "Amin Rashidbeigi"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://aminrb.me/go-test-double/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Amin Rashidbeigi",
    "logo": {
      "@type": "ImageObject",
      "url": "https://aminrb.me/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://aminrb.me/" accesskey="h" title="Amin Rashidbeigi (Alt + H)">Amin Rashidbeigi</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://aminrb.me/fa/" title="فارسی"
                            aria-label="فارسی">فارسی</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://aminrb.me/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://aminrb.me/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://aminrb.me/side-projects/" title="Side Projects">
                    <span>Side Projects</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Go Test Doubles by Example
    </h1>
    <div class="post-description">
      Test doubles serve as an alternative to real dependencies in testing. In this post, we&#39;ll review all test doubles using a real-world Go example.
    </div>
    <div class="post-meta"><span title='2023-12-31 14:37:31 +0330 +0330'>December 31, 2023</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Amin Rashidbeigi

</div>
  </header> 
<figure class="entry-cover"><a href="https://aminrb.me/go-test-double/go-test-double.jpg" target="_blank"
            rel="noopener noreferrer"><img loading="eager" src="https://aminrb.me/go-test-double/go-test-double.jpg" alt="test double in go."></a>
        <p>Image Generated with <a href="https://openai.com/dall-e-3" target="_blank" rel="noopener">DALL.E 3</a></p>
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#what-are-test-doubles" aria-label="What Are Test Doubles?">What Are Test Doubles?</a></li>
                <li>
                    <a href="#test-doubles-by-an-example" aria-label="Test Doubles by an Example">Test Doubles by an Example</a><ul>
                        
                <li>
                    <a href="#payment-gateway-dependency" aria-label="Payment Gateway Dependency">Payment Gateway Dependency</a></li>
                <li>
                    <a href="#payment-processor" aria-label="Payment Processor">Payment Processor</a></li>
                <li>
                    <a href="#test-doubles-implementations" aria-label="Test Doubles Implementations">Test Doubles Implementations</a><ul>
                        
                <li>
                    <a href="#dummy" aria-label="Dummy">Dummy</a></li>
                <li>
                    <a href="#fake" aria-label="Fake">Fake</a></li>
                <li>
                    <a href="#mock" aria-label="Mock">Mock</a></li>
                <li>
                    <a href="#stub" aria-label="Stub">Stub</a></li>
                <li>
                    <a href="#spy" aria-label="Spy">Spy</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#wrapping-up" aria-label="Wrapping up">Wrapping up</a></li>
                <li>
                    <a href="#further-reading" aria-label="Further Reading">Further Reading</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>When writing tests for a program, we often need to consider dependencies and external APIs that we prefer not to call every time the test runs. Calling these external dependencies not only adds complexity to our tests but also incurs costs. To address this issue, we can use test doubles.</p>
<h2 id="what-are-test-doubles">What Are Test Doubles?<a hidden class="anchor" aria-hidden="true" href="#what-are-test-doubles">#</a></h2>
<p>Test doubles offer an alternative to real dependencies. While we commonly refer to all of them as mocks, there are various test doubles, each serving different purposes.</p>
<p>Let&rsquo;s briefly review each type of test double:</p>
<ul>
<li><strong>Fake</strong>: Fakes are actual implementations of dependencies, in a simpler and chipper way. Consider a scenario where we have a database dependency. We can create a fake in-memory database that implements the database interface, allowing us to use it as a substitute for the actual database.</li>
<li><strong>Dummy</strong>: Dummies act as placeholder objects. We don&rsquo;t utilize their functionalities; instead, we pass parameters just to fulfill test requirements. We don&rsquo;t want to test their logic or behavior.</li>
<li><strong>Mock</strong>: Sometimes we want to test the behavior of our logic rather than the implementation or output. Mocks are for this purpose. For instance, ensuring a specific API called only once per request can be achieved by mocking that API.</li>
<li><strong>Stub</strong>: When testing particular logic, we might need to assess the program&rsquo;s state rather than its behavior. Stubs come into play by generating predefined responses for specific parameters.</li>
<li><strong>Spy</strong>: Spies, similar to stubs, offer dynamic behavior based on how they&rsquo;re invoked, providing a more interactive aspect. We can say that spies inherit from both stubs and mocks.</li>
</ul>
<p>If you&rsquo;re unfamiliar with test doubles and want to read more about them, check the <a href="#further-reading">resources</a> I&rsquo;ve referenced at the end of the post.</p>
<h2 id="test-doubles-by-an-example">Test Doubles by an Example<a hidden class="anchor" aria-hidden="true" href="#test-doubles-by-an-example">#</a></h2>
<p>Now that we&rsquo;ve reviewed all test doubles, let&rsquo;s explain each of them using a real-world Go example.</p>
<p>Imagine we have a Payment service that depends on a payment gateway and contains a <code>ProcessPayment</code> method implementing logic when a user submits a payment. We want to write some test double for the payment package.</p>
<h3 id="payment-gateway-dependency">Payment Gateway Dependency<a hidden class="anchor" aria-hidden="true" href="#payment-gateway-dependency">#</a></h3>
<p>First of all, let&rsquo;s define a simple implementation of an example gateway:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">gateway</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;errors&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">RealPaymentGateway</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">RealPaymentGateway</span><span class="p">)</span> <span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid payment amount&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="payment-processor">Payment Processor<a hidden class="anchor" aria-hidden="true" href="#payment-processor">#</a></h3>
<p>Now, let&rsquo;s create a simple implementation of the <code>PaymentProcessor</code>. A <code>gateway</code> is as an input for this processor, and it includes a <code>Process</code> function that calls the <code>ProcessPayment</code> method of the gateway.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">payment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PaymentGateway</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PaymentProcessor</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">gateway</span> <span class="nx">PaymentGateway</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="nx">gateway</span> <span class="nx">PaymentGateway</span><span class="p">)</span> <span class="o">*</span><span class="nx">PaymentProcessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">PaymentProcessor</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">gateway</span><span class="p">:</span> <span class="nx">gateway</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="nx">PaymentProcessor</span><span class="p">)</span> <span class="nf">Process</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">gateway</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">amount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, let&rsquo;s initialize our program with the <code>main</code> function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/aminrashidbeigi/go-test-doubles/gateway&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/aminrashidbeigi/go-test-doubles/payment&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">realPaymentGateway</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">gateway</span><span class="p">.</span><span class="nx">RealPaymentGateway</span><span class="p">{}</span> 
</span></span><span class="line"><span class="cl">	<span class="nx">paymentProcessor</span> <span class="o">:=</span> <span class="nx">payment</span><span class="p">.</span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="nx">realPaymentGateway</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">amount</span> <span class="o">:=</span> <span class="mf">100.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">paymentProcessor</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="nx">amount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Payment failed:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Payment processed successfully!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When we run this program we get this output:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Payment processed successfully!
</span></span></code></pre></div><p>So, our program works well. Now, we&rsquo;ve reached the fun part – writing tests!</p>
<h3 id="test-doubles-implementations">Test Doubles Implementations<a hidden class="anchor" aria-hidden="true" href="#test-doubles-implementations">#</a></h3>
<h4 id="dummy">Dummy<a hidden class="anchor" aria-hidden="true" href="#dummy">#</a></h4>
<p>As I said, dummy just pass parameters to initialize a dependency and we don’t expect anything from them. In this example, the <code>PaymentGatewayDummy</code> satisfies the <code>PaymentGateway</code> interface by implementing the <code>ProcessPayment</code> method but does nothing inside the method. It&rsquo;s simply there to fulfill the requirement of a <code>PaymentGateway</code> object for the tests that rely on this interface.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PaymentGatewayDummy</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">PaymentGatewayDummy</span><span class="p">)</span> <span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestPaymentProcessor_WithDummy</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">paymentProcessor</span> <span class="o">:=</span> <span class="nx">payment</span><span class="p">.</span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">PaymentGatewayDummy</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">paymentProcessor</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Expected no error, got %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="fake">Fake<a hidden class="anchor" aria-hidden="true" href="#fake">#</a></h4>
<p>In the payment system example, the <code>PaymentGatewayFake</code> provides an alternative implementation with simpler logic. Here&rsquo;s the fake implementation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PaymentGatewayFake</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">PaymentGatewayFake</span><span class="p">)</span> <span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid amount&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestPaymentProcessor_WithFake</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">paymentProcessor</span> <span class="o">:=</span> <span class="nx">payment</span><span class="p">.</span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">PaymentGatewayFake</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">paymentProcessor</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;Expected an error for zero amount, got none&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">errNegative</span> <span class="o">:=</span> <span class="nx">paymentProcessor</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">errNegative</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;Expected an error for negative amount, got none&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mock">Mock<a hidden class="anchor" aria-hidden="true" href="#mock">#</a></h4>
<p>Mocks are used to define and enforce expectations on interactions with an object. They specify certain method calls with specific parameters and help verify that these interactions occur as expected during tests. In this example, the mock records each call made to <code>ProcessPayment</code>, allowing later verification to ensure that the expected method calls happened in the specified order and with the correct parameters.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PaymentGatewayMock</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">calls</span>      <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">callAmount</span> <span class="kt">float64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">PaymentGatewayMock</span><span class="p">)</span> <span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nx">calls</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">calls</span><span class="p">,</span> <span class="s">&#34;ProcessPayment&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span><span class="p">.</span><span class="nx">callAmount</span> <span class="p">=</span> <span class="nx">amount</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">PaymentGatewayMock</span><span class="p">)</span> <span class="nf">VerifyCalls</span><span class="p">(</span><span class="nx">expectedCalls</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">expectedCalls</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">calls</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">call</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">expectedCalls</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">call</span> <span class="o">!=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">calls</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestPaymentProcessor_WithMock</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">paymentGatewayMock</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">PaymentGatewayMock</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">paymentProcessor</span> <span class="o">:=</span> <span class="nx">payment</span><span class="p">.</span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="nx">paymentGatewayMock</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">amount</span> <span class="o">:=</span> <span class="mf">75.0</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="p">=</span> <span class="nx">paymentProcessor</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="nx">amount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">expectedCalls</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;ProcessPayment&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">paymentGatewayMock</span><span class="p">.</span><span class="nf">VerifyCalls</span><span class="p">(</span><span class="nx">expectedCalls</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Expected calls %v, got %v&#34;</span><span class="p">,</span> <span class="nx">expectedCalls</span><span class="p">,</span> <span class="nx">paymentGatewayMock</span><span class="p">.</span><span class="nx">calls</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">paymentGatewayMock</span><span class="p">.</span><span class="nx">callAmount</span> <span class="o">!=</span> <span class="nx">amount</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Expected call amount %f, got %f&#34;</span><span class="p">,</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">paymentGatewayMock</span><span class="p">.</span><span class="nx">callAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="stub">Stub<a hidden class="anchor" aria-hidden="true" href="#stub">#</a></h4>
<p>The stub here represents a simplified version of the <code>PaymentGateway</code>. It has a <code>success</code> boolean field that determines whether the payment should be successful or fail. The <code>ProcessPayment</code> method of the stub checks the <code>success</code> field and returns an error if <code>success</code> is set to <code>false</code>, simulating a failed payment.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PaymentGatewayStub</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">success</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">PaymentGatewayStub</span><span class="p">)</span> <span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">s</span><span class="p">.</span><span class="nx">success</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;payment failed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestPaymentProcessor_WithStub_SuccessfulPayment</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">paymentProcessor</span> <span class="o">:=</span> <span class="nx">payment</span><span class="p">.</span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">PaymentGatewayStub</span><span class="p">{</span><span class="nx">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">paymentProcessor</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Expected no error, got %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestPaymentProcessor_WithStub_FailedPayment</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">paymentProcessor</span> <span class="o">:=</span> <span class="nx">payment</span><span class="p">.</span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">PaymentGatewayStub</span><span class="p">{</span><span class="nx">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">paymentProcessor</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="mf">50.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;Expected an error, got none&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="spy">Spy<a hidden class="anchor" aria-hidden="true" href="#spy">#</a></h4>
<p>The spy here is used to track and record information about interactions with the <code>PaymentGateway</code>. It has <code>called</code> and <code>amount</code> fields to record whether the <code>ProcessPayment</code> method has been called and the amount passed to it. During testing, the spy captures and records this information, allowing tests to assert whether certain interactions have occurred.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">PaymentGatewaySpy</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">called</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">	<span class="nx">amount</span> <span class="kt">float64</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">PaymentGatewaySpy</span><span class="p">)</span> <span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nx">called</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nx">amount</span> <span class="p">=</span> <span class="nx">amount</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestPaymentProcessor_WithSpy</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">paymentGatewaySpy</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">PaymentGatewaySpy</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">paymentProcessor</span> <span class="o">:=</span> <span class="nx">payment</span><span class="p">.</span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="nx">paymentGatewaySpy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">amount</span> <span class="o">:=</span> <span class="mf">75.0</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="p">=</span> <span class="nx">paymentProcessor</span><span class="p">.</span><span class="nf">Process</span><span class="p">(</span><span class="nx">amount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">!</span><span class="nx">paymentGatewaySpy</span><span class="p">.</span><span class="nx">called</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;Expected PaymentGatewaySpy to be called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">paymentGatewaySpy</span><span class="p">.</span><span class="nx">amount</span> <span class="o">!=</span> <span class="nx">amount</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Expected amount %f, got %f&#34;</span><span class="p">,</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">paymentGatewaySpy</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="wrapping-up">Wrapping up<a hidden class="anchor" aria-hidden="true" href="#wrapping-up">#</a></h2>
<p>Each type of test double—dummies, stubs, spies, mocks, and fakes—has its unique role in testing of our code. They help us check if our code works correctly, create specific situations for testing, and make sure our tests happen in a safe space with reduced complexity and cost.</p>
<p>I&rsquo;ve placed all this code in a GitHub repository. You can check it here: <a href="https://github.com/aminrashidbeigi/go-test-double" target="_blank" rel="noopener">Go Test Double</a>.</p>
<h2 id="further-reading">Further Reading<a hidden class="anchor" aria-hidden="true" href="#further-reading">#</a></h2>
<ul>
<li><a href="https://martinfowler.com/bliki/TestDouble.html" target="_blank" rel="noopener">TestDouble</a> - Martin Fowler</li>
<li><a href="https://martinfowler.com/articles/mocksArentStubs.html" target="_blank" rel="noopener">Mocks Aren&rsquo;t Stubs</a> - Martin Fowler</li>
<li><a href="http://xunitpatterns.com/Test%20Double.html" target="_blank" rel="noopener">Test Double</a> - XUnitPatterns</li>
</ul>

<hr>
If you found this post helpful, I recommend following <a href="https://twitter.com/AminRashidbeigi" target="_blank">my Twitter</a> account or subscribing to the <a href="https://aminrbme.beehiiv.com/subscribe" target="_blank">email newsletter</a> to stay updated on future writings.
  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://aminrb.me/tags/test-double/">test double</a></li>
      <li><a href="https://aminrb.me/tags/go/">go</a></li>
      <li><a href="https://aminrb.me/tags/fake/">fake</a></li>
      <li><a href="https://aminrb.me/tags/spy/">spy</a></li>
      <li><a href="https://aminrb.me/tags/mock/">mock</a></li>
      <li><a href="https://aminrb.me/tags/stub/">stub</a></li>
      <li><a href="https://aminrb.me/tags/dummy/">dummy</a></li>
      <li><a href="https://aminrb.me/tags/testing/">testing</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://aminrb.me/extra-work/">
    <span class="title">Next »</span>
    <br>
    <span>Navigating Extra Work in Programming Teams</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Go Test Doubles by Example on x"
            href="https://x.com/intent/tweet/?text=Go%20Test%20Doubles%20by%20Example&amp;url=https%3a%2f%2faminrb.me%2fgo-test-double%2f&amp;hashtags=testdouble%2cgo%2cfake%2cspy%2cmock%2cstub%2cdummy%2ctesting">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Go Test Doubles by Example on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2faminrb.me%2fgo-test-double%2f&amp;title=Go%20Test%20Doubles%20by%20Example&amp;summary=Go%20Test%20Doubles%20by%20Example&amp;source=https%3a%2f%2faminrb.me%2fgo-test-double%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Go Test Doubles by Example on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2faminrb.me%2fgo-test-double%2f&title=Go%20Test%20Doubles%20by%20Example">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Go Test Doubles by Example on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2faminrb.me%2fgo-test-double%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Go Test Doubles by Example on whatsapp"
            href="https://api.whatsapp.com/send?text=Go%20Test%20Doubles%20by%20Example%20-%20https%3a%2f%2faminrb.me%2fgo-test-double%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Go Test Doubles by Example on telegram"
            href="https://telegram.me/share/url?text=Go%20Test%20Doubles%20by%20Example&amp;url=https%3a%2f%2faminrb.me%2fgo-test-double%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Go Test Doubles by Example on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Go%20Test%20Doubles%20by%20Example&u=https%3a%2f%2faminrb.me%2fgo-test-double%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "aminrbg" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://aminrb.me/">Amin Rashidbeigi</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
